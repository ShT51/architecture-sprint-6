## Анализ проблем и рисков текущей архитектуры InsureTech взаимодействия сервисов core-app, ins-comp-settlement и ins-product-aggregator

### 1. Проблемы производительности и масштабируемости
- cинхронные REST-вызовы между сервисами приводят к:
  - долгим ответам из-за цепочек вызовов между сервисом `ins-product-aggregator` --> `внешние API страховых компаний`: время ответа будет не быстрее
  ответа самого медленного `внешнего API страховой компании`
  - низкой отказоустойчивости: если один из сервисов или внешних API тормозит, это влияет на всю цепочку вызовов
  - разовый забор данных сервисом `ins-comp-settlement` из `ins-product-aggregator` приводит к большому объему трафика и времени выполнения запроса,
  а также росту потребления ОЗУ сервисом
  - увеличение кол-ва страховых компаний в 2 усугубляет описанные выше проблемы в 2, `ins-product-aggregator` становится узким местом 
- нет кэширования часто запрашиваемых данных (например, списка страховых продуктов)

### 2. Локальные реплики данных в `core-app` и `ins-comp-settlement` 
- локальные данные устаревают, что может приводить к расхождениям
- сокращение интервала с 15 минут и с 1 раз в сутки лишь увеличат нагрузку на системы, но принципиально не решат проблему

## Замена синхронных вызовов на Event-Streaming
1. Внедрение брокера сообщений **Kafka** и переход на асинхронное взаимодействия между всеми сервисами:
- `ins-product-aggregator` публикует события об изменениях тарифов и продуктов в страховых компаниях
- `core-app` и `ins-comp-settlement` подписываются на эти события и обновляют локальные данные и кеши (Redis/Hazelcast)
- `core-app` публикует события о новых страховках, а сервис `ins-comp-settlement` подписываются на эти события

2. Использование паттерна **Transactional Outbox** для гарантированной отправки событий
- `ins-product-aggregator` при получении событий об изменениях тарифов и продуктов в страховых компаниях сохраняет их в свою БД,
а потом отдельным фоновым процессом или CDC потокм отправляет их в брокер
- `core-app` при оформлении новой страховки, также сохраняет событие в свою локальную БД, и через фоновый процесс или CDC поток
отправляет сообщение в брокер